import * as stories from './Table.stories.tsx'
import { SecondaryBgDecorator } from '../../../.storybook/utils'
import { Table } from '.'
import { ArgsTable, Canvas, Meta, Story } from '@storybook/addon-docs/blocks'

# Table

The `Table` component creates a table from a provided data source. It allows for column configuration, data configuration, sorting and global table searching.

The following examples start from a basic table and don't show all possible types of data that the table can render. If you'd like to view all possible column types and formats in one place, [click here.](?path=/docs/table--mixed#columntype--all-column-types-and-formats)

<Meta decorators={[SecondaryBgDecorator]} title='Table' component={Table} />

## Simple Usage

Simple usage of the `Table` requires two props — `data` and `columns`.

1. `data` - Data must be provided as an array of objects with keys that match column key - `dataIndex`. Each data item must also include a unique `id` of type `string` or `number`.
2. `columns` - Columns must be provided as an array of objects with — a required `dataIndex` key, a required `title` key which will be the title of the column and a required data `type` key which determines the type of data to be rendered. Array order in columns will determine the column order in the table.

You specify the data object interface and the `ColumnType` will be imported from Dassana's library. The `ColumnType` shown here isn't comprehensive, but stripped down to keep things simple:

```ts
enum ColumnTypes = {
  string: 'string',
  number: 'number'
}

interface ColumnType {
	dataIndex: string
	title: string
	type: ColumnTypes.string | ColumnTypes.number
}
```

This is the code for a simple table:

```ts
import {
	ColumnType,
	ColumnTypes,
	Table,
	TableProps
} from '@dassana-io/web-components'

const { number, string } = ColumnTypes

// You specify the data object interface.
export interface Person {
	name: string
	id: number | string
	age: number
}

const columns: ColumnType[] = [
	{
		dataIndex: 'name',
		title: 'Name',
		type: string
	},
	{
		dataIndex: 'age',
		title: 'Age',
		type: number
	}
]

const data: Person[] = [
	{
		age: 36,
		id: 0,
		name: 'Lorem'
	},
	{
		age: 32,
		id: 1,
		name: 'Ipsum'
	},
	{
		age: 45,
		id: 2,
		name: 'Amet'
	},
	{
		age: 50,
		id: 3,
		name: 'Elit'
	},
	{
		age: 22,
		id: 4,
		name: 'Dolor'
	}
]

// You pass the Person interface to the TableProps as a generic type.
const tableProps: TableProps<Person> = { columns, data }

const PeopleTable = () => <Table<Person> {...tableProps} />
```

The rendered table generated by the above code will look like:

<Canvas>
	<Story story={stories.Simple} name='Simple' />
</Canvas>

<ArgsTable story='Simple' />

## Searching and Search Props

The Table has a global search field that uses [Fuse.js](https://fusejs.io/) to fuzzy search the table. Both formatted and unformatted number data type can be searched. Searching is also enabled by default. To disable search, pass it as a prop to the table. E.g.

```ts
const tableProps = TableProps<Person> = { columns, data, search: false }
```

The search bar is rendered on the left without a placeholder by default. You can change it by passing the following props to the table:

```ts
const tableProps: TableProps<Person> = {
	columns,
	data,
	searchProps: {
		placeholder: 'Search...',
		placement: 'right'
	}
}
```

Take a look at the [Missing Cells Table](?path=/docs/table--missing-cells#missing-data-cells) for an example.

## Sorting

Each column is sortable by default. To disable sort on a specific column, add `sort: false` to the column configuration object. E.g.

```ts
const columns: ColumnType[] = [
	{
		dataIndex: 'name',
		title: 'Name',
		type: ColumnTypes.string
	},
	{
		dataIndex: 'age',
		sort: false,
		title: 'Age',
		type: ColumnTypes.number
	}
]
```

## Advanced Usage

### Column keys: `type` and `format`

Other than raw `string` and `number` data types, the table is able to render complex data like formatted numbers, components like tags, links etc.

There are a total of three data types — `number | string | component`. A data `type` can have several formats unique to itself. A `format` for `string` and `number` is optional. By default, they will have a `format` of `none` and will be rendered as is without formatting. You can also pass an optional `renderProps` with some of the format types to customize display.

### Column key `type`: `number` and related formats

A `number` can have the format: `date | byte`.

1. **date**: In addition to a `format` key with value `date`, you can pass in an additional key - `displayFormat` for date. The table uses moment.js under the hood to format a **unix timestamp** into a date. You can pass a string of tokens and they will get replaced with their corresponding values. Examples of various date formats can be found at [moment.js](https://momentjs.com/docs/#/displaying/format/).

    An example with column type: `number`, format: `date` and a custom display format - `displayFormat`

    ```js
    // column object
    {
      dataIndex: 'updated_at',
      format: ColumnFormats.date,
      renderProps: {
        displayFormat: 'MM/DD/YYYY',
      }
      title: 'Updated Time',
      type: ColumnTypes.number
    }
    // example data object
    {
      updated_at: 1598400668681,
      ...
    }
    // The rendered formatted number:
    '08/25/2020'
    ```

2. **byte**: A `number` type can also be formatted as `byte`. The table uses [bytes](https://www.npmjs.com/package/bytes) under the hood. E.g.:

    ```js
    {
      dataIndex: 'data_size',
      format: ColumnFormats.byte,
      title: 'Data Size',
      type: ColumnTypes.number
    }
    // example data object
    {
      data_size: 1024,
      ...
    }
    // The rendered formatted number:
    '1KB'
    ```

#### Representing `ColumnType` with typescript

ColumnType is a union of various other types. And `NumberType` is a union of three other types:

```ts
type ColumnType = StringType | NumberType | ComponentType
type NumberType = NumberDefaultType | NumberDateType | NumberByteType

enum ColumnTypes {
	number = 'number'
}

enum ColumnFormats {
	none = 'none',
	date = 'date',
	byte = 'byte'
}

interface NumberDefaultType {
	dataIndex: string
	title: string
	type: ColumnTypes.number
	format?: ColumnFormats.none
	sort?: boolean
}

interface NumberDateType {
	dataIndex: string
	title: string
	type: ColumnTypes.number
	format?: ColumnFormats.date
	sort?: boolean
	renderProps?: {
		displayFormat?: string
	}
}

interface NumberByteType {
	dataIndex: string
	title: string
	type: ColumnTypes.number
	format?: ColumnFormats.byte
	sort?: boolean
}
```

Here's an example of a table with data type: `number` and formats: `date`, `byte`:

```ts
import {
	ColumnFormats,
	ColumnType,
	ColumnTypes,
	DateDisplayFormat,
	Table,
	TableProps
} from '@dassana-io/web-components'

const { number, string } = ColumnTypes
const { byte, date } = ColumnFormats

export interface File {
	created_at: number
	data_size: number
	id: number
	file_name: string
	last_opened?: number
	updated_at?: number // Pass an optional type if there will be missing data
}

const columns: ColumnType[] = [
	{
		dataIndex: 'file_name',
		title: 'File Name',
		type: string
	},
	{
		dataIndex: 'data_size',
		format: byte,
		title: 'Size',
		type: number
	},
	{
		dataIndex: 'last_opened',
		format: date,
		renderProps: { displayFormat: DateDisplayFormat.fromNow }, // display date as time from now. E.g. 3 months ago
		title: 'Last Opened',
		type: number
	},
	{
		dataIndex: 'created_at',
		format: date,
		renderProps: { displayFormat: dateFormat0 }, // moment.js display format
		title: 'Uploaded Time',
		type: number
	},
	{
		dataIndex: 'updated_at',
		format: date,
		renderProps: { displayFormat: dateFormat1 }, // moment.js format shortcuts also work
		title: 'Last Updated Time',
		type: number
	}
]

const data: File[] = [
	{
		created_at: 1598400668681,
		data_size: 1048576,
		file_name: 'IMG_4542.jpeg',
		id: 0,
		last_opened: 1598400668681
	},
	{
		created_at: 1582330066861,
		data_size: 1998576,
		file_name: 'test_123.png',
		id: 1,
		last_opened: 1603779899922
	},
	{
		created_at: 1553223066861,
		data_size: 1024,
		file_name: 'passwords.txt',
		id: 2,
		updated_at: 1582330063211
	},
	{
		created_at: 1511022066861,
		data_size: 4194599,
		file_name: 'birthday.mp4',
		id: 3
	},
	{
		created_at: 1515021066861,
		data_size: 2048,
		file_name: 'letter.txt',
		id: 4,
		updated_at: 1515121066861
	}
]

const tableProps: TableProps<File> = {
	columns,
	data
}
const FilesTable = () => <Table<File> {...tableProps} />
```

The rendered table generated by the above code will look like:

<Canvas>
	<Story story={stories.Number} name='Number' />
</Canvas>

<ArgsTable story='Number' />

### Column key `type`: `component` and related formats

A `component` type can have the format: `icon | link | tag | toggle`. Unlike `string` and `number` data types, a `format` is required for a `component` type.

#### Representing `ColumnType` with typescript

ColumnType is a union of various other types. And `ComponentType` is a union of four other types:

```ts
type ColumnType = StringType | NumberType | ComponentType
type ComponentType =
	| ComponentIconType
	| ComponentLinkType
	| ComponentTagType
	| ComponentToggleType

enum ColumnTypes {
	component = 'component'
}

enum ColumnFormats {
	icon = 'icon',
	link = 'link',
	tag = 'tag',
	toggle = 'toggle'
}

/* type - component, format - icon */
interface RenderPropsIcon {
	type: 'icon'
	iconMap: {
		[key: string]: string
	}
	height?: number
}

interface RenderPropsIconKey {
	type: 'iconKey'
	height?: number
}

interface ComponentIconType {
	dataIndex: string
	title: string
	type: ColumnTypes.component
	format: ColumnFormats.icon
	renderProps: RenderPropsIcon | RenderPropsIconKey
	sort?: boolean
}

/* type - component, format - link */
interface ComponentLinkType {
	dataIndex: string
	title: string
	type: ColumnTypes.component
	format: ColumnFormats.link
	sort?: boolean
	renderProps?: {
		buildHref: (record?: string) => string
		target?: '_self' | '_blank'
	}
}

/* type - component, format - tag */
interface ComponentTagType {
	dataIndex: string
	title: string
	type: ColumnTypes.component
	format: ColumnFormats.tag
	sort?: boolean
}

/* type - component, format - toggle */
interface ComponentToggleType {
	dataIndex: string
	title: string
	type: ColumnTypes.component
	format: ColumnFormats.toggle
	sort?: boolean
}
/* -------------------------- */
```

Here's an example of a table with data type: `component` and formats: `icon`, `link`, `tag` and `toggle`:

```js
import {
	ColumnFormats,
	ColumnType,
	ColumnTypes,
	IconName,
	Table,
	TableProps
} from '@dassana-io/web-components'

const { component, number, string } = ColumnTypes
const { date, icon, link, toggle, tag } = ColumnFormats

export interface Client {
	admin_access: boolean
	company: IconName
	id: number
	linked_in: string
	name: string
	role: { name: string; color: string }
	start_date: number
}


const columns: ColumnType[] = [
	{
		dataIndex: 'name',
		title: 'Name',
		type: string
	},
	{
		dataIndex: 'start_date',
		format: date,
		renderProps: {
			displayFormat: 'MM/DD/YYYY'
		},
		title: 'Client Since',
		type: number
	},
	{
		dataIndex: 'role',
		format: tag,
		title: 'Role',
		type: component
	},
	{
		dataIndex: 'linked_in',
		format: link,
		renderProps: {
			buildHref: (): string => '/',
			target: '_blank'
		},
		title: 'LinkedIn',
		type: component
	},
	{
		dataIndex: 'admin_access',
		format: toggle,
		title: 'Has Admin Access',
		type: component
	},
	{
		dataIndex: 'company',
		format: icon,
		renderProps: {
			type: 'iconKey'
		},
		title: 'Company',
		type: component
	}
]

const data: Client[] = [
	{
		admin_access: true,
		company: 'azure',
		id: 0,
		linked_in: 'lorem-i',
		name: 'Lorem Ipsum',
		role: { color: 'blue', name: 'CEO' },
		start_date: 1519782342212
	},
	{
		admin_access: false,
		company: 'aws',
		id: 1,
		linked_in: 'dolor-s',
		name: 'Dolor Sit',
		role: { color: 'magenta', name: 'Software Engineer' },
		start_date: 1593682342212
	},
	{
		admin_access: true,
		company: 'dassana',
		id: 2,
		linked_in: 'amet-c',
		name: 'Amet Consectetur',
		role: { color: 'green', name: 'Designer' },
		start_date: 1553932342212
	},
	{
		admin_access: false,
		company: 'googleCloudService',
		id: 3,
		linked_in: 'duis-irure',
		name: 'Duis Irure',
		role: { color: 'purple', name: 'Business Development' },
		start_date: 1531932342212
	}
]

const tableProps: TableProps<Client> = { columns, data };

export const ClientsTable = () => <Table<Client> {...tableProps} />;

```

The rendered table:

<Canvas>
	<Story story={stories.Mixed} name='Mixed' />
</Canvas>

<ArgsTable story='Mixed' />

### Missing Data Cells

Make sure to declare keys as optional in the typescript interface if there will be missing data.

```ts
export interface Client1 {
	admin_access?: boolean
	company?: string
	id: number
	linked_in?: string
	name?: string
	role?: { name: string; color: string }
	start_date?: number
}
```

Click on the "Show Code" at the bottom right corner of the rendered table to view what columns and data arrays are.

<Canvas>
	<Story story={stories.MissingCells} name='Missing Cells' />
</Canvas>

<ArgsTable story='Missing Cells' />

### `ColumnType` — All column types and formats

```ts
enum ColumnTypes {
	string = 'string',
	number = 'number',
	component = 'component'
}

enum ColumnFormats {
	none = 'none',
	date = 'date',
	byte = 'byte',
	icon = 'icon',
	link = 'link',
	tag = 'tag',
	toggle = 'toggle'
}

/* type - string */
interface StringType {
	dataIndex: string
	title: string
	type: ColumnTypes.string
	format?: ColumnFormats.none
	sort?: boolean
}
/* ------------------------------- */

/* type - number, format - none */
interface NumberDefaultType {
	dataIndex: string
	title: string
	type: ColumnTypes.number
	format?: ColumnFormats.none
	sort?: boolean
}

/* type - number, format - date */
interface NumberDateType {
	dataIndex: string
	title: string
	type: ColumnTypes.number
	format?: ColumnFormats.date
	sort?: boolean
	renderProps?: {
		displayFormat?: string
	}
}

/* type - number, format - byte */
interface NumberByteType {
	dataIndex: string
	title: string
	type: ColumnTypes.number
	format?: ColumnFormats.byte
	sort?: boolean
}

type NumberType = NumberDefaultType | NumberDateType | NumberByteType;
/* ------------------------------- */

/* type - component, format - icon */
interface RenderPropsIcon {
	type: 'icon'
	iconMap: {
		[key: string]: string
	}
	height?: number
}

interface RenderPropsIconKey {
	type: 'iconKey'
	height?: number
}

interface ComponentIconType {
	dataIndex: string
	title: string
	type: ColumnTypes.component
	format: ColumnFormats.icon
	renderProps: RenderPropsIcon | RenderPropsIconKey
	sort?: boolean
}

/* type - component, format - link */
interface ComponentLinkType {
	dataIndex: string
	title: string
	type: ColumnTypes.component
	format: ColumnFormats.link
	sort?: boolean
	renderProps?: {
		buildHref: (record?: string) => string
		target?: '_self' | '_blank'
	}
}

/* type - component, format - tag */
interface ComponentTagType {
	dataIndex: string
	title: string
	type: ColumnTypes.component
	format: ColumnFormats.tag
	sort?: boolean
}

/* type - component, format - toggle */
interface ComponentToggleType {
	dataIndex: string
	title: string
	type: ColumnTypes.component
	format: ColumnFormats.toggle
	sort?: boolean
}
/* ------------------------------- */

type ComponentType = ComponentIconType | ComponentLinkType | ComponentTagType | ComponentToggleType

export type type ColumnType = StringType | NumberType | ComponentType
```

<Canvas>
	<Story story={stories.Paginated} name='Paginated' />
</Canvas>

<Canvas>
	<Story story={stories.ColoredDot} name='Colored Dot' />
</Canvas>
