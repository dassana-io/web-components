import { Meta, Story, Canvas } from '@storybook/addon-docs/blocks'
import Table from '.'
import * as stories from './Table.stories.tsx'

# Table

The `Table` component creates a table from a provided data source. It allows for column configuration, data configuration, sorting and global table searching.

<Meta title='Table' component={Table} />

## Simple Usage

Simple usage of the `Table` requires two props — `data` and `columns`.

1. `data` - Data must be provided as an array of objects with keys that match column key - `dataIndex`.
2. `columns` - Columns must be provided as an array of objects with — a required `dataIndex` key, a required `title` key which will be the title of the column and a required data `type` key which determines the type of data to be rendered. Array order in columns will determine the column order in the table.

You specify the data object interface and the `ColumnType` will be imported from dassana's library. The `ColumnType` shown here isn't comprehensive, but stripped down to keep things simple:

```ts
interface ColumnType {
	dataIndex: string
	title: string
	type: string | number
}
```

This is the code for a simple table:

```ts
import {
	ColumnType,
	TableProps
} from '@dassana-io/web-components/lib/types/Button'
import { Table } from '@dassana-io/web-components'

// You specify the data object interface. This will be referred to as DataType
export interface Person {
	name: string
	age: number
}

const data: Person[] = [
	{
		age: 36,
		name: 'Lorem'
	},
	{
		age: 32,
		name: 'Ipsum'
	}
]

const columns: ColumnType[] = [
	{
		dataIndex: 'name',
		title: 'Name',
		type: 'string'
	},
	{
		dataIndex: 'age',
		title: 'Age',
		type: 'number'
	}
]

// You pass the Person interface to the TableProps as a generic type.
const tableProps: TableProps<Person> = { columns, data }

const PeopleTable = () => <Table {...tableProps} />
```

The rendered table generated by the above code will look like:

<Story story={stories.Simple} />

## Advanced Usage

### Column keys: `type` and `format`

Other than raw `string` and `number` data types, the table is able to render complex data like formatted numbers, other components like tags, links etc.

There are a total of three data types — `'number' | 'string' | 'component'`. A data `type` can have several formats unique to itself. A `format` for `string` and `number` is optional. By default, they will have a `format` of `none` and will be rendered as is without formatting. E.g. columb object

#### Column key `type`: `number` and related formats

A `number` can have the format: `'date' | 'byte'`.

1. **date**: In addition to a `format` key with value `date`, you can pass in an additional key - `displayFormat` for date. The table uses moment.js under the hood to format a **unix timestamp** into a date. You can pass a string of tokens and they will get replaced with their corresponding values. Examples of various date formats can be found at [moment.js](https://momentjs.com/docs/#/displaying/format/).

    An example with column type: `number`, format: `date` and a custom display format - `displayFormat`

```js
// column object
{
  dataIndex: 'updated_at',
  displayFormat: 'MM/DD/YYYY',
  format: 'date',
  title: 'Updated Time',
  type: 'number'
}
// example data object
{
  updated_at: 1598400668681,
  ...
}
// The rendered formatted date:
'08/25/2020'
```

2. **byte**: A `number` type can also be formatted as `byte`. The table uses [bytes](https://www.npmjs.com/package/bytes) under the hood. E.g.:

```js
{
  dataIndex: 'data_size',
  format: 'byte',
  title: 'Data Size',
  type: 'number'
}
// example data object
{
  data_size: 1024,
  ...
}
// The rendered formatted date:
'1KB'
```

Here's an example of a table with data type: `number` and formats: `date`, `byte`:

```ts
import {
	ColumnType,
	TableProps
} from '@dassana-io/web-components/lib/types/Button'
import { Table } from '@dassana-io/web-components'

export interface File {
	file_name: string
	data_size: number
	created_at: number
	updated_at?: number // optional keys won't be rendered
}

const columns: ColumnType[] = [
	{
		dataIndex: 'file_name',
		title: 'File Name',
		type: 'string'
	},
	{
		dataIndex: 'data_size',
		format: 'byte',
		title: 'Data',
		type: 'number'
	},
	{
		dataIndex: 'created_at',
		displayFormat: 'MMM D, YYYY h:mm A', // moment.js display format
		format: 'date',
		title: 'Uploaded Time',
		type: 'number'
	},
	{
		dataIndex: 'updated_at',
		displayFormat: 'lll', //moment.js format shortcuts also work
		format: 'date',
		title: 'Last Updated Time',
		type: 'number'
	}
]

const data: File[] = [
	{
		created_at: 1598400668681,
		data_size: 1048576,
		file_name: 'IMG_4542.jpeg'
	},
	{
		created_at: 1582330066861,
		data_size: 1998576,
		file_name: 'test_123.png'
	},
	{
		created_at: 1553223066861,
		data_size: 1024,
		file_name: 'passwords.txt',
		updated_at: 1582330063211
	}
]

const tableProps: TableProps<File> = { columns, data }
const FilesTable = () => <Table {...tableProps} />
```

The rendered table generated by the above code will look like:

<Story story={stories.Number} />

#### Column key `type`: `number` and related formats

A `component` type can have the format: `'icon' | 'link' | 'tag' | 'toggle'`. Unlike `string` and `number` data types, a `format` is required for a `component` type. You can import the typescript prop types for each of these components and declare that in the `DataType` interface. Then you pass in the component props in the data object. E.g.:

```js
import {
  ColumnType,
  IconProps,
  LinkProps,
	TableProps,
  TagProps,
  ToggleProps
} from '@dassana-io/web-components/lib/types/Button'
import { Table } from '@dassana-io/web-components'

interface Client {
	name: string
	start_date: number
	role: TagProps
	linked_in: LinkProps
	admin_access: ToggleProps
	company: IconProps
}

const columns: ColumnType[] = [
	{
		dataIndex: 'name',
		title: 'Name',
		type: 'string'
	},
	{
		dataIndex: 'start_date',
		displayFormat: 'MM/DD/YYYY',
		format: 'date',
		title: 'Client Since',
		type: 'number'
	},
	{
		dataIndex: 'role',
		format: 'tag',
		title: 'Role',
		type: 'component'
	},
	{
		dataIndex: 'linked_in',
		format: 'link',
		title: 'LinkedIn',
		type: 'component'
	},
	{
		dataIndex: 'admin_access',
		format: 'toggle',
		title: 'Has Admin Access',
		type: 'component'
	},
	{
		dataIndex: 'company',
		format: 'icon',
		title: 'Company',
		type: 'component'
	}
]

const toggleProps: ToggleProps = {
	onChange: () => {
		console.log('toggled')
	},
	size: 'small'
}

const linkProps: LinkProps = {
	children: 'link',
	href: '/',
	target: '_blank'
}

const data: Client[] = [
	{
		admin_access: { ...toggleProps, defaultChecked: true },
		company: {
			iconKey: 'dassana-blue'
		},
		linked_in: { ...linkProps, children: '/in/lorem-i' },
		name: 'Lorem Ipsum',
		role: { children: 'CEO', color: 'blue' },
		start_date: 1519782342212
	},
	{
		admin_access: { ...toggleProps, defaultChecked: false, disabled: true },
		company: {
			iconKey: 'aws-logo'
		},
		linked_in: { ...linkProps, children: '/in/dolor-s' },
		name: 'Dolor Sit',
		role: { children: 'Software Engineer', color: 'magenta' },
		start_date: 1593682342212
	},
	{
		admin_access: { ...toggleProps },
		company: {
			iconKey: 'dassana-orange'
		},
		linked_in: { ...linkProps, children: '/in/amet-c' },
		name: 'Amet Consectetur',
		role: { children: 'Designer', color: 'green' },
		start_date: 1553932342212
	},
	{
		admin_access: { ...toggleProps, defaultChecked: true },
		company: {
			icon: 'https://dummyimage.com/200x200/000/fff&text=C'
		},
		linked_in: { ...linkProps, children: '/in/duis-irure' },
		name: 'Duis Irure',
		role: { children: 'Business Development', color: 'purple' },
		start_date: 1531932342212
	}
]

const tableProps: TableProps<Client> = { columns, data }

export const ClientsTable = () => <Table {...tableProps} />
```

The rendered table:

<Story story={stories.Default} />
